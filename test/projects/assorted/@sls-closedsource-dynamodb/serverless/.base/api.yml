provider:
  cfnRole: '${cf:${opt:service}-data-${self:provider.stage}.CfnAssumeRoleArn}'
  resourcePolicy:
    - Effect: Allow
      Principal: '*'
      Action: 'execute-api:Invoke'
      Resource:
        'Fn::Join':
          - ':'
          - - 'arn:aws:execute-api'
            - Ref: 'AWS::Region'
            - Ref: 'AWS::AccountId'
            - '*/*'

resources:
  Conditions:
    DataHashMismatchCondition:
      'Fn::Equals':
        - '${cf:${opt:service}-data-${self:provider.stage}.dataStackHash}'
        - '${self:resources.Outputs.dataStackHash.Value}'
  Outputs:
    dataHashErrorCondition:
      Value:
        'Fn::If':
          - DataHashMismatchCondition
          - '-'
          - 'Fn::ImportValue': Data.Stack.Hash.Mismatch
    dataStackHash:
      Value: ${fileFn(^/data-stack-hash.cjs)}

<<<:
  - ${file(^/../api.yml)}
